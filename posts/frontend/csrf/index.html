<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.eb75a59a15386a11debc.css" id="gatsby-global-css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.test233{background-color:red}code[class*=language-],pre[class*=language-]{font-family:Consolas,Menlo,Monaco,Andale Mono WT,Andale Mono,Lucida Console,Lucida Sans Typewriter,DejaVu Sans Mono,Bitstream Vera Sans Mono,Liberation Mono,Nimbus Mono L,Courier New,Courier,monospace;font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;background:#f3f3f3;color:#6e6b5e}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#e8e4cf}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999580}.token.punctuation{color:#6e6b5e}.token.namespace{opacity:.7}.token.boolean,.token.number,.token.operator{color:#b65611}.token.property{color:#ae9513}.token.tag{color:#6684e1}.token.string{color:#1fad83}.token.selector{color:#b854d4}.token.attr-name{color:#b65611}.language-css .token.string,.style .token.string,.token.entity,.token.url{color:#1fad83}.token.attr-value,.token.control,.token.directive,.token.keyword,.token.unit{color:#60ac39}.token.atrule,.token.regex,.token.statement{color:#1fad83}.token.placeholder,.token.variable{color:#6684e1}.token.deleted{text-decoration:line-through}.token.inserted{border-bottom:1px dotted #20201d;text-decoration:none}.token.italic{font-style:italic}.token.bold,.token.important{font-weight:700}.token.important{color:#d73737}.token.entity{cursor:help}pre>code.highlight{outline:.4em solid #d73737;outline-offset:.4em}.line-numbers .line-numbers-rows{border-right-color:#e8e4cf}.line-numbers-rows>span:before{color:#a6a28c}.line-highlight{background:rgba(125,122,104,.2);background:linear-gradient(90deg,rgba(125,122,104,.2) 70%,rgba(125,122,104,0))}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}body{font-family:Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;font-weight:300;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:14px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:300}a{color:#010101;text-decoration:none}a:visited{color:#000}a:hover{color:#111;text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:scroll}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:740px;margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px}@media screen and (max-width:800px){.wrapper{max-width:770px;padding-right:15px;padding-left:15px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:56px;position:relative}.site-title{font-size:26px;line-height:56px;letter-spacing:-1px;margin-bottom:0;float:left}.site-title,.site-title:visited{color:#424242}.site-nav{float:right;line-height:56px}.site-nav .menu-icon{display:none}.site-nav .page-link{color:#111;line-height:1.5}.site-nav .page-link:not(:first-child){margin-left:20px}@media screen and (max-width:600px){.site-nav{position:absolute;top:9px;right:30px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .menu-icon{display:block;float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg{width:18px;height:15px}.site-nav .menu-icon>svg path{fill:#424242}.site-nav .trigger{clear:both;display:none}.site-nav:hover .trigger{display:block;padding-bottom:5px}.site-nav .page-link{display:block;padding:5px 10px}}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{float:left;margin-bottom:15px;padding-left:15px}.footer-col-1{width:calc(35% - 15px)}.footer-col-2{width:calc(20% - 15px)}.footer-col-3{width:calc(45% - 15px)}@media screen and (max-width:800px){.footer-col-1,.footer-col-2{width:calc(50% - 15px)}.footer-col-3{width:calc(100% - 15px)}}@media screen and (max-width:600px){.footer-col{float:none;width:calc(100% - 15px)}}.page-content{padding:30px 0}.page-heading{font-size:20px}.post-list{margin-left:0;list-style:none}.post-list>li{margin:3em 0}.post{margin-bottom:2.666em;padding-bottom:1.333em;border-bottom:thin solid #f3f3f3}.post-meta{font-family:Merriweather,"PT Serif",Georgia,Times New Roman,serif;font-style:italic;font-size:1.25rem;color:#7a7a7a}.post-link{font-family:Lato,Helvetica Neue,Helvetica,sans-serif;font-weight:600;display:block;font-size:3.18rem;line-height:1.2;color:#333;margin-top:.125em;margin-bottom:.5em}.post-link:hover{text-decoration:none}.post-summary{font-size:1.25rem;line-height:1.8}.post-header{margin-bottom:30px}.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (max-width:800px){.post-title{font-size:36px}}.post-content{margin-bottom:30px}.post-content h2{font-size:32px}@media screen and (max-width:800px){.post-content h2{font-size:28px}}.post-content h3{font-size:26px}@media screen and (max-width:800px){.post-content h3{font-size:22px}}.post-content h4{font-size:20px}@media screen and (max-width:800px){.post-content h4{font-size:18px}}.pagination{font-family:Lato,Helvetica Neue,Helvetica,sans-serif;font-weight:300;display:block;font-size:1rem}.pagination .left{float:left}.pagination .left:hover{text-decoration:none}.pagination .right,.rss-subscribe{float:right}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true"></title><style data-styled="" data-styled-version="4.2.0"></style><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-ae15f791eb5575d8475d.js"/><link as="script" rel="preload" href="/d2956fd2-0ae29e111819bacacda1.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-e2d108adf87d88a25c5f.js"/><link as="script" rel="preload" href="/app-8f1dd6984be419e5a444.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-content-js-c3c209be4da0b01b0f5c.js"/><link as="fetch" rel="preload" href="/page-data/posts/frontend/csrf/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="page-content"><div class="wrapper"><div class="post"><header class="post-header"><h1 class="post-title">CSRF</h1><p class="post-meta">July 08, 2019</p></header><article class="post-content"><h2>What is CSRF</h2>
<p>Cross-Site Request Forgery (CSRF) is a type of attack that occurs when a malicious web site, email, blog, instant message, or program causes <strong>a user’s web browser to perform an unwanted action on a trusted site when the user is authenticated</strong>. </p>
<p>A CSRF attack works because browser requests automatically include any credentials associated with the site, such as the user's session cookie, IP address, etc. Therefore, if the user is authenticated to the site, the site cannot distinguish between the forged or legitimate request sent by the victim. We would need a <code class="language-text">token/identifier</code> that is not accessible to attacker and would not be sent along with forged requests that attacker initiates.</p>
<p>The impact of a successful CSRF attack is limited to the capabilities exposed by the vulnerable application. For example, this attack could result in a transfer of funds, changing a password, or making a purchase with the user’s credentials.</p>
<p>Using social engineering, an attacker can embed malicious HTML or JavaScript code into an email or website to request a specific 'task URL'. The task then executes with or without the user's knowledge, either directly or by using a Cross-Site Scripting flaw.</p>
<h3>CSRF example</h3>
<p>For example, a typical GET request for a $100 bank transfer might look like:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">GET http://netbank.com/transfer.do?acct=PersonB&amp;amount=$100 HTTP/1.1</code></pre></div>
<p>A hacker can modify this script so it results in a $100 transfer to their own account. Now the malicious request might look like:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">GET http://netbank.com/transfer.do?acct=AttackerA&amp;amount=$100 HTTP/1.1</code></pre></div>
<p>A bad actor can embed the request into an innocent looking hyperlink:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;a href=&quot;http://netbank.com/transfer.do?acct=AttackerA&amp;amount=$100&quot;&gt;Read more!&lt;/a&gt;</code></pre></div>
<p>Next, he can distribute the hyperlink via email to a large number of bank customers. Those who click on the link while logged into their bank account will unintentionally initiate the $100 transfer.</p>
<p>If the bank’s website is only using POST requests, it’s impossible to frame malicious requests using a <code class="language-text">&lt;a&gt;</code> href tag. However, the attack could be delivered in a <code class="language-text">&lt;form&gt;</code> tag with automatic execution of the embedded JavaScript.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>document.forms[0].submit()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://netbank.com/transfer.do<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>acct<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>AttackerA<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>amount<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$100<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>View my pictures!<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></div>
<p>CSRFs are typically conducted using malicious social engineering, such as an email or link that tricks the victim into sending a forged request to a server. As the unsuspecting user is authenticated by their application at the time of the attack, it’s impossible to distinguish a legitimate request from a forged one.</p>
<p><img src="https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/csrf-cross-site-request-forgery.png" alt="CSRF"></p>
<h3>Limitations</h3>
<p>The attack is blind: the attacker cannot see what the target website sends back to the victim in response to the forged requests, unless they exploit a cross-site scripting or other bug at the target website.</p>
<ul>
<li>The attacker must target either a site that doesn't check the referrer header or a victim with a browser or plugin that allows referer spoofing.[citation needed]</li>
<li>The attacker must find a form submission at the target site, or a URL that has side effects, that does something (e.g., transfers money, or changes the victim's e-mail address or password).</li>
<li>The attacker must determine the right values for all the forms or URL inputs; if any of them are required to be secret authentication values or IDs that the attacker can't guess, the attack will most likely fail (unless the attacker is extremely lucky in their guess).</li>
<li>The attacker must lure the victim to a web page with malicious code while the victim is logged into the target site.</li>
</ul>
<h2>Primary defense technique</h2>
<h3>Token based mitigation</h3>
<h4>Synchronizer Token Pattern</h4>
<p>Any state changing operation requires a secure random token to prevent CSRF attacks. The CSRF token is added as a hidden field for forms, headers/parameters for AJAX calls (and within the URL if the state changing operation occurs via a GET). The server will rejects the requested action if the CSRF token fails validation.</p>
<p><strong>Inserting the CSRF token in the HTTP request header</strong> via JavaScript is considered more secure than adding the token in the hidden field form parameter. In this situation, even if the CSRF token is weak, predictable or leaked but still an attacker cannot forge the POST request directly by setting the custom request header through XMLHttpRequest. When the attacker tries to set any custom header through any XMLHttpRequest, the browser sends the <strong>OPTIONS (pre-flight) request</strong>, the browser prevents the forged request to be sent.</p>
<p>When a Web application formulates a request, the application should include a hidden input parameter with a common name such as "CSRFToken" (for forms) as header/parameter value for Ajax calls. The value of this token must be randomly generated such that it cannot be guessed by an attacker. Consider leveraging the <code class="language-text">java.security.SecureRandom</code> class for Java applications to generate a sufficiently long random token. Alternative generation algorithms include the use of <code class="language-text">256-bit BASE64</code> encoded hashes. </p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/transfer.do<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CSRFToken<span class="token punctuation">"</span></span>
<span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZMGYwMGEwOA==<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></div>
<br>
<h5>Disclosure of Token in URL</h5>
<p>Some implementations of synchronizer tokens include the challenge token in GET (URL) requests as well as POST requests. While this control does help mitigate the risk of CSRF attacks, the unique per-session token is being exposed for GET requests. CSRF tokens in GET requests are potentially leaked at several locations: </p>
<ul>
<li>browser history</li>
<li>log files</li>
<li>network appliances that make a point to log the first line of an HTTP request</li>
<li>referer headers if the protected site links to an external site.</li>
</ul>
<p>The ideal solution is to only include the CSRF token in POST requests and modify server-side actions that have state changing affect to only respond to POST requests.</p>
<h4>Encryption based Token Pattern</h4>
<p>The Encrypted Token Pattern leverages an encryption, rather than comparison method of Token-validation. It is most suitable for applications that do not want to maintain any state at server side.</p>
<p>Server generates a token comprised of the user's session ID and a timestamp (to prevent replay attacks) using a unique key available only on the server. This token is returned to the client and embedded in a hidden field for forms, in the request-header/parameter for AJAX requests. On receipt of this request, the server reads and decrypts the token value with the same key used to create the token.  Once decrypted, If session-id matches and the timestamp is under the defined token expiry time, request can be allowed.</p>
<h4>HMAC Based Token Pattern</h4>
<p>HMAC Based Token Pattern mitigation is also achieved without maintaining any state at the server. HMAC based CSRF protection works similar to encryption based CSRF protection with a couple of minor differences:</p>
<ul>
<li>Use strong HMAC function (SHA256 or stronger algorithms are recommended) instead of an encryption function to generate the token</li>
<li>Token is HMAC+timestamp</li>
</ul>
<h3>Auto CSRF Mitigation Techniques</h3>
<p>Though the technique of mitigating tokens is widely used (stateful with synchronizer token and stateless with encrypted/HMAC token), the major problem associated with these techniques is the human tendency to forget things at times.</p>
<p>To avoid this, you can try to automate the process of adding tokens to CSRF vulnerable resources:</p>
<ul>
<li>write wrappers</li>
<li>write a hook</li>
<li>use client side script</li>
<li>in-build framework</li>
</ul>
<h3>Defense In Depth Techniques</h3>
<h4>Verifying origin with standard headers</h4>
<p>At server side we verify if source origin and target origin match, we accept the request as legitimate and if they don’t, we discard the request.</p>
<h5>Identifying Source Origin</h5>
<ul>
<li>If the Origin header is present, verify that its value matches the target origin.</li>
<li>If the Origin header is not present, verify the hostname in the Referer header matches the target origin.</li>
<li>If neither of these headers are present, you can either accept or block the request.</li>
</ul>
<p>In both cases, the target origin check is strong. For example, if your site is site.com make sure site.com.attacker.com does not pass your origin check.</p>
<h5>Identifying the Target Origin</h5>
<p>If you are behind a proxy, there are a number of options to consider.</p>
<ul>
<li>Configure your application to simply know its target origin.</li>
<li>Use the Host header value.</li>
<li>Use the X-Forwarded-Host header value.</li>
</ul>
<h4>Double Submit Cookie</h4>
<p>If maintaining the state for CSRF token at server side is problematic, an alternative defense is to use the double submit cookie technique. This technique is easy to implement and is stateless. In this technique.</p>
<p>We send a random value in both a cookie and as a request parameter, with the server verifying if the cookie value and request value match. When a user visits the site should generate a pseudorandom value and <strong>set it as a cookie on the user's machine</strong> separate from the session identifier. The site then requires that every transaction request include this pseudorandom value as a hidden form value. If both of them match at server side, the server accepts it as legitimate request and if they don’t, it would reject the request.</p>
<p>There’s a belief that this technique would work because a cross origin attacker cannot read any data sent from the server or modify cookie values.</p>
<p>There are a couple of drawbacks associated with the assumptions made here. The problem of "trusting of sub domains and proper configuration of whole site in general to accept HTTPS connections only".</p>
<h4>Samesite Cookie Attribute</h4>
<p>SameSite is a cookie attribute (similar to HTTPOnly, Secure etc.) introduced by Google to mitigate CSRF attacks. This attribute helps in preventing the browser from sending cookies along with cross-site requests, possible values are lax or strict.</p>
<p>The strict value will prevent the cookie from being sent by the browser to the target site in all cross-site browsing context, even when following a regular link.</p>
<p>For example, for a GitHub-like website, if a logged-in user follows a link to a private GitHub project posted on a corporate discussion forum or email, GitHub will not receive the session cookie and the user will not be able to access the project.</p>
<p>Though this technique seems to be efficient in mitigating CSRF attacks, it is still in early stages (in draft) and does not have full browser support as mentioned above.</p>
<p>Considering the factors above, it is not recommended to be used as a primary defense. Google agrees with this stance and strongly encourages developers to deploy server-side defenses such as tokens to mitigate CSRF more fully.</p>
<h4>Use of Custom Request Headers</h4>
<p>An alternate defense that is particularly well suited for AJAX/XHR endpoints is the use of a custom request header. This defense relies on the <code class="language-text">same-origin policy</code> (SOP) restriction that only JavaScript can be used to add a custom header, and only within its origin. By default, browsers do not allow JavaScript to make cross origin requests.</p>
<h4>User Interaction Based CSRF Defense</h4>
<p>It’s easier or more appropriate to involve the user in the transaction to prevent unauthorized operations:</p>
<ul>
<li>Re-Authentication (password or stronger)</li>
<li>One-time Token</li>
<li>CAPTCHA</li>
</ul>
<p>For applications that are in need of high security for some operations. Please note that tokens by themselves can mitigate CSRF, developers should use these techniques only to achieve additional security for their high sensitive operations.</p>
<h3>Not So Popular CSRF Mitigations</h3>
<ul>
<li>Triple Submit Cookie</li>
<li>Content-Type Header Validation</li>
</ul>
<h2>Resources</h2>
<p><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.md">OWASP</a></p>
<p><a href="https://www.acunetix.com/websitesecurity/csrf-attacks/">CSRF Attacks: Anatomy, Prevention, and XSRF Tokens</a> - acunetix</p>
<p><a href="https://www.imperva.com/learn/application-security/csrf-cross-site-request-forgery/">Cross site request forgery (CSRF) attack</a> - imperva</p>
<p><a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross-site request forgery</a> - wikipedia</p></article></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/frontend/csrf";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1a17365e929552d2af9c.js"],"app":["/app-8f1dd6984be419e5a444.js"],"component---src-pages-404-js":["/component---src-pages-404-js-1446f3ed376632b984cb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-6513bea8160630181fca.js"],"component---src-templates-blog-content-js":["/component---src-templates-blog-content-js-c3c209be4da0b01b0f5c.js"],"component---src-templates-blog-page-js":["/component---src-templates-blog-page-js-d40b3321bffef7be4fc3.js"],"component---src-templates-game-games-template-js":["/component---src-templates-game-games-template-js-2830ca606daf45b9b6eb.js"],"component---src-templates-game-rawg-template-js":["/component---src-templates-game-rawg-template-js-8e978b54875d675360d4.js"]};/*]]>*/</script><script src="/polyfill-1a17365e929552d2af9c.js" nomodule=""></script><script src="/component---src-templates-blog-content-js-c3c209be4da0b01b0f5c.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-8f1dd6984be419e5a444.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-e2d108adf87d88a25c5f.js" async=""></script><script src="/d2956fd2-0ae29e111819bacacda1.js" async=""></script><script src="/webpack-runtime-ae15f791eb5575d8475d.js" async=""></script></body></html>