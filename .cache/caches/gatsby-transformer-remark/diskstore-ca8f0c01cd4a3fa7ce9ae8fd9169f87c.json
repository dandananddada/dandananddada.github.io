{"expireTime":9007200917962570000,"key":"transformer-remark-markdown-ast-b2c61fe6ce6db52efb0a4a22eb3527d2-gatsby-remark-prismjs-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"Rails本身是提供一套自动化测试体系的，对于比较小型或者时间短促的项目采用原生的测试体系也是可以的，当然第三方自动化测试插件语法、功能、开发上相对也会更加便捷一些。\n这里要介绍的插件有rspec-rail、capybara、factory","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":2,"column":37,"offset":120},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":2,"column":38,"offset":121},"end":{"line":2,"column":42,"offset":125},"indent":[]}}],"position":{"start":{"line":2,"column":37,"offset":120},"end":{"line":2,"column":43,"offset":126},"indent":[]}},{"type":"text","value":"rails、database_cleaner以及guard-rspec。","position":{"start":{"line":2,"column":43,"offset":126},"end":{"line":2,"column":79,"offset":162},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":2,"column":79,"offset":162},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"【1】gems introduction","position":{"start":{"line":4,"column":1,"offset":164},"end":{"line":4,"column":21,"offset":184},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":164},"end":{"line":4,"column":21,"offset":184},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"首先简单对这些gems做一下介绍。\nrspec-rail 是一个自动化测试插件，github地址：","position":{"start":{"line":6,"column":1,"offset":186},"end":{"line":7,"column":32,"offset":235},"indent":[1]}},{"type":"link","title":null,"url":"https://github.com/rspec/rspec-rails。","children":[{"type":"text","value":"https://github.com/rspec/rspec-rails。","position":{"start":{"line":7,"column":32,"offset":235},"end":{"line":7,"column":69,"offset":272},"indent":[]}}],"position":{"start":{"line":7,"column":32,"offset":235},"end":{"line":7,"column":69,"offset":272},"indent":[]}},{"type":"text","value":"\ncapybara是一个集成测试插件，它提供了更加语义话的语法模拟用户操作，githbu地址：","position":{"start":{"line":7,"column":69,"offset":272},"end":{"line":8,"column":47,"offset":319},"indent":[1]}},{"type":"link","title":null,"url":"https://github.com/jnicklas/capybara。","children":[{"type":"text","value":"https://github.com/jnicklas/capybara。","position":{"start":{"line":8,"column":47,"offset":319},"end":{"line":8,"column":84,"offset":356},"indent":[]}}],"position":{"start":{"line":8,"column":47,"offset":319},"end":{"line":8,"column":84,"offset":356},"indent":[]}},{"type":"text","value":"\nfactory","position":{"start":{"line":8,"column":84,"offset":356},"end":{"line":9,"column":8,"offset":364},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":9,"column":9,"offset":365},"end":{"line":9,"column":13,"offset":369},"indent":[]}}],"position":{"start":{"line":9,"column":8,"offset":364},"end":{"line":9,"column":14,"offset":370},"indent":[]}},{"type":"text","value":"rails是用来替代rails fixtures的测试数据插件，gihubt地址：","position":{"start":{"line":9,"column":14,"offset":370},"end":{"line":9,"column":55,"offset":411},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/thoughtbot/factory_girl_rails，文档地址：https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md。","children":[{"type":"text","value":"https://github.com/thoughtbot/factory","position":{"start":{"line":9,"column":55,"offset":411},"end":{"line":9,"column":92,"offset":448},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":9,"column":93,"offset":449},"end":{"line":9,"column":97,"offset":453},"indent":[]}}],"position":{"start":{"line":9,"column":92,"offset":448},"end":{"line":9,"column":98,"offset":454},"indent":[]}},{"type":"text","value":"rails，文档地址：https://github.com/thoughtbot/factory","position":{"start":{"line":9,"column":98,"offset":454},"end":{"line":9,"column":146,"offset":502},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl/blob/master/GETTING","position":{"start":{"line":9,"column":147,"offset":503},"end":{"line":9,"column":171,"offset":527},"indent":[]}}],"position":{"start":{"line":9,"column":146,"offset":502},"end":{"line":9,"column":172,"offset":528},"indent":[]}},{"type":"text","value":"STARTED.md。","position":{"start":{"line":9,"column":172,"offset":528},"end":{"line":9,"column":183,"offset":539},"indent":[]}}],"position":{"start":{"line":9,"column":55,"offset":411},"end":{"line":9,"column":183,"offset":539},"indent":[]}},{"type":"text","value":"\ndatabase","position":{"start":{"line":9,"column":183,"offset":539},"end":{"line":10,"column":9,"offset":548},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"cleaner是用来清理数据库的插件，github地址：","position":{"start":{"line":10,"column":10,"offset":549},"end":{"line":10,"column":38,"offset":577},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/DatabaseCleaner/database","children":[{"type":"text","value":"https://github.com/DatabaseCleaner/database","position":{"start":{"line":10,"column":38,"offset":577},"end":{"line":10,"column":81,"offset":620},"indent":[]}}],"position":{"start":{"line":10,"column":38,"offset":577},"end":{"line":10,"column":81,"offset":620},"indent":[]}}],"position":{"start":{"line":10,"column":9,"offset":548},"end":{"line":10,"column":82,"offset":621},"indent":[]}},{"type":"text","value":"cleaner\nguard-rspec是一个自动化运行工具，他会帮你监测文件修改，并自动执行测试用例。gihubt地址：","position":{"start":{"line":10,"column":82,"offset":621},"end":{"line":11,"column":53,"offset":681},"indent":[1]}},{"type":"link","title":null,"url":"https://github.com/guard/guard-rspec。","children":[{"type":"text","value":"https://github.com/guard/guard-rspec。","position":{"start":{"line":11,"column":53,"offset":681},"end":{"line":11,"column":90,"offset":718},"indent":[]}}],"position":{"start":{"line":11,"column":53,"offset":681},"end":{"line":11,"column":90,"offset":718},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":186},"end":{"line":11,"column":90,"offset":718},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【2】install gems\n在Gemfile中添加如下代码：","position":{"start":{"line":13,"column":1,"offset":720},"end":{"line":14,"column":17,"offset":752},"indent":[1]}}],"position":{"start":{"line":13,"column":1,"offset":720},"end":{"line":14,"column":17,"offset":752},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">group <span class=\"token symbol\">:development</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:test</span> <span class=\"token keyword\">do</span>\n  gem <span class=\"token string\">'rspec-rails'</span>\n<span class=\"token keyword\">end</span>\n\ngroup <span class=\"token symbol\">:test</span> <span class=\"token keyword\">do</span>\n\tgem <span class=\"token string\">'factory_girl_rails'</span>\n\tgem <span class=\"token string\">'capybara'</span>\n\tgem <span class=\"token string\">'guard-rspec'</span>\n\tgem <span class=\"token string\">'database_cleaner'</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":16,"column":1,"offset":754},"end":{"line":27,"column":4,"offset":923},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"插件安装好后需要针对每一个插件进行一些必要的配置。","position":{"start":{"line":28,"column":1,"offset":924},"end":{"line":28,"column":26,"offset":949},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":924},"end":{"line":28,"column":26,"offset":949},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"【3】config gems","position":{"start":{"line":30,"column":1,"offset":951},"end":{"line":30,"column":15,"offset":965},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":951},"end":{"line":30,"column":15,"offset":965},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"1】执行如下命令安装rspec-rails\n","position":{"start":{"line":32,"column":1,"offset":967},"end":{"line":33,"column":1,"offset":989},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">$ rails generate rspec:install</code>","position":{"start":{"line":33,"column":1,"offset":989},"end":{"line":33,"column":33,"offset":1021},"indent":[]}},{"type":"text","value":"\n之后rspec会在项目根目录下创建一个spec目录以及一个rails","position":{"start":{"line":33,"column":33,"offset":1021},"end":{"line":34,"column":35,"offset":1056},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"helper.rb文件和一个spec","position":{"start":{"line":34,"column":36,"offset":1057},"end":{"line":34,"column":54,"offset":1075},"indent":[]}}],"position":{"start":{"line":34,"column":35,"offset":1056},"end":{"line":34,"column":55,"offset":1076},"indent":[]}},{"type":"text","value":"helper.rb文件。\t下面内容将主要对rails_helper.rb文件进行配置。","position":{"start":{"line":34,"column":55,"offset":1076},"end":{"line":34,"column":98,"offset":1119},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":967},"end":{"line":34,"column":98,"offset":1119},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"2】整合capybara和rspec，首先打开rails_helper.rb文件，你会看到文件头部有自动生成如下语句：","position":{"start":{"line":36,"column":1,"offset":1121},"end":{"line":36,"column":60,"offset":1180},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":1121},"end":{"line":36,"column":60,"offset":1180},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'RAILS_ENV'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span><span class=\"token operator\">=</span> <span class=\"token string\">'test'</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'spec_helper'</span>\n<span class=\"token keyword\">require</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>expand_path<span class=\"token punctuation\">(</span><span class=\"token string\">'../../config/environment'</span><span class=\"token punctuation\">,</span> __FILE__<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'rspec/rails'</span></code></pre></div>","position":{"start":{"line":38,"column":1,"offset":1182},"end":{"line":43,"column":4,"offset":1328},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"在这段下面添加如下语句引入capybara，这样就在测试文件里引用capybara了。","position":{"start":{"line":44,"column":1,"offset":1329},"end":{"line":44,"column":44,"offset":1372},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":1329},"end":{"line":44,"column":44,"offset":1372},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'capybara/rspec'</span></code></pre></div>","position":{"start":{"line":46,"column":1,"offset":1374},"end":{"line":48,"column":4,"offset":1410},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"但是目前还无法直接调用capybara的方法，还需要在rails_helper.rb中进一步配置。\n找到RSpec.configure代码段，并添加如下代码：","position":{"start":{"line":49,"column":1,"offset":1411},"end":{"line":50,"column":30,"offset":1490},"indent":[1]}}],"position":{"start":{"line":49,"column":1,"offset":1411},"end":{"line":50,"column":30,"offset":1490},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"> config<span class=\"token punctuation\">.</span>include <span class=\"token constant\">Capybara</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">DSL</span></code></pre></div>","position":{"start":{"line":52,"column":1,"offset":1492},"end":{"line":54,"column":4,"offset":1533},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"这样就可以在测试类中调用Capybara的方法了。","position":{"start":{"line":55,"column":1,"offset":1534},"end":{"line":55,"column":26,"offset":1559},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1534},"end":{"line":55,"column":26,"offset":1559},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"3】整合factory","position":{"start":{"line":57,"column":1,"offset":1561},"end":{"line":57,"column":12,"offset":1572},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":57,"column":13,"offset":1573},"end":{"line":57,"column":17,"offset":1577},"indent":[]}}],"position":{"start":{"line":57,"column":12,"offset":1572},"end":{"line":57,"column":18,"offset":1578},"indent":[]}},{"type":"text","value":"rails，这里factory","position":{"start":{"line":57,"column":18,"offset":1578},"end":{"line":57,"column":33,"offset":1593},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":57,"column":34,"offset":1594},"end":{"line":57,"column":38,"offset":1598},"indent":[]}}],"position":{"start":{"line":57,"column":33,"offset":1593},"end":{"line":57,"column":39,"offset":1599},"indent":[]}},{"type":"text","value":"rails可以采用support配置方式来整合，也可以像Capybara一样直接在rails","position":{"start":{"line":57,"column":39,"offset":1599},"end":{"line":57,"column":85,"offset":1645},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"helper.rb中添加引用，我先说明引用方式的整合。\n同Capybara类似，在rails","position":{"start":{"line":57,"column":86,"offset":1646},"end":{"line":58,"column":19,"offset":1692},"indent":[1]}}],"position":{"start":{"line":57,"column":85,"offset":1645},"end":{"line":58,"column":20,"offset":1693},"indent":[1]}},{"type":"text","value":"helper.rb的RSpec.configure代码段中添加如下代码：","position":{"start":{"line":58,"column":20,"offset":1693},"end":{"line":58,"column":56,"offset":1729},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1561},"end":{"line":58,"column":56,"offset":1729},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">config<span class=\"token punctuation\">.</span>include <span class=\"token constant\">FactoryGirl</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Syntax</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Methods</span></code></pre></div>","position":{"start":{"line":60,"column":1,"offset":1731},"end":{"line":62,"column":4,"offset":1786},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"这样就可以在测试文件中使用factory","position":{"start":{"line":63,"column":1,"offset":1787},"end":{"line":63,"column":21,"offset":1807},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl的方法了。\n另外一种稍微复杂的方式是通过support整合，这里简单说明下如何配置，但是并不推荐，除非你有额外的需求需要配置。\n首先取消rails","position":{"start":{"line":63,"column":22,"offset":1808},"end":{"line":65,"column":10,"offset":1885},"indent":[1,1]}}],"position":{"start":{"line":63,"column":21,"offset":1807},"end":{"line":65,"column":11,"offset":1886},"indent":[1,1]}},{"type":"text","value":"helper.rb中这段代码的注释","position":{"start":{"line":65,"column":11,"offset":1886},"end":{"line":65,"column":28,"offset":1903},"indent":[]}}],"position":{"start":{"line":63,"column":1,"offset":1787},"end":{"line":65,"column":28,"offset":1903},"indent":[1,1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\">#Dir[Rails.root.join('spec/support/**/*.rb')].each { |f| require f }</span></code></pre></div>","position":{"start":{"line":67,"column":1,"offset":1905},"end":{"line":69,"column":4,"offset":1985},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"接下来在spec目录下创建一个support目录，并添加factory_girls.rb文件，代码如下：","position":{"start":{"line":70,"column":1,"offset":1986},"end":{"line":70,"column":53,"offset":2038},"indent":[]}}],"position":{"start":{"line":70,"column":1,"offset":1986},"end":{"line":70,"column":53,"offset":2038},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># spec/support/factory_girl.rb</span>\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n  config<span class=\"token punctuation\">.</span>include <span class=\"token constant\">FactoryGirl</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Syntax</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Methods</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":72,"column":1,"offset":2040},"end":{"line":77,"column":4,"offset":2160},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"这样也可以实现和第一种直接加代码段同样的效果（其实这种方式只是将配置抽离成文件形式而已）。\n最后在spec目录下添加factories.rb文件，这个文件就是factory","position":{"start":{"line":78,"column":1,"offset":2161},"end":{"line":79,"column":41,"offset":2247},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"girl","position":{"start":{"line":79,"column":42,"offset":2248},"end":{"line":79,"column":46,"offset":2252},"indent":[]}}],"position":{"start":{"line":79,"column":41,"offset":2247},"end":{"line":79,"column":47,"offset":2253},"indent":[]}},{"type":"text","value":"rails用来维护测试数据的，也就是取代rails fixtures功能的文件。我会在稍后简单介绍如何使用。\n4】整合database","position":{"start":{"line":79,"column":47,"offset":2253},"end":{"line":80,"column":13,"offset":2320},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"cleaner，同样在rails","position":{"start":{"line":80,"column":14,"offset":2321},"end":{"line":80,"column":30,"offset":2337},"indent":[]}}],"position":{"start":{"line":80,"column":13,"offset":2320},"end":{"line":80,"column":31,"offset":2338},"indent":[]}},{"type":"text","value":"helper.rb文件中加入database_cleaner的引入语句：","position":{"start":{"line":80,"column":31,"offset":2338},"end":{"line":80,"column":67,"offset":2374},"indent":[]}}],"position":{"start":{"line":78,"column":1,"offset":2161},"end":{"line":80,"column":67,"offset":2374},"indent":[1,1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'database_cleaner'</span></code></pre></div>","position":{"start":{"line":82,"column":1,"offset":2376},"end":{"line":84,"column":4,"offset":2414},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"5】初始化guard，在命令行执行如下命令：\n","position":{"start":{"line":85,"column":1,"offset":2415},"end":{"line":86,"column":1,"offset":2438},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">$ guard init rspec</code>","position":{"start":{"line":86,"column":1,"offset":2438},"end":{"line":86,"column":21,"offset":2458},"indent":[]}},{"type":"text","value":"\n执行如下命令启动guard，监听测试文件的修改并执行测试用例：\n","position":{"start":{"line":86,"column":21,"offset":2458},"end":{"line":88,"column":1,"offset":2491},"indent":[1,1]}},{"type":"html","value":"<code class=\"language-text\">$ guard</code>","position":{"start":{"line":88,"column":1,"offset":2491},"end":{"line":88,"column":10,"offset":2500},"indent":[]}},{"type":"text","value":"\n接下来就可以创建测试文件并实现测试方法进行测试了。","position":{"start":{"line":88,"column":10,"offset":2500},"end":{"line":89,"column":26,"offset":2526},"indent":[1]}}],"position":{"start":{"line":85,"column":1,"offset":2415},"end":{"line":89,"column":26,"offset":2526},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【3】how to use rspec-rails","position":{"start":{"line":91,"column":1,"offset":2528},"end":{"line":91,"column":26,"offset":2553},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":2528},"end":{"line":91,"column":26,"offset":2553},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"因为rspec是整个测试过程中作为“容器”或者说做根本的插件，所以首先说明如何使用rspec。\n首先说明下，当你install rspec-rails后，再执行rails g 命名自动创建文件后，rspec-rails会帮你在spec目录下创建对应的测试文件，同时原本在test目录下创建的文件将不再自动生成。这个时候针对你要进行的不同测试选择对应的文件去编程就可以了。当然除此之外你也可以生成特定的测试文件，具体命令如下：\n生成单元测试文件，针对models进行测试：\n","position":{"start":{"line":93,"column":1,"offset":2555},"end":{"line":96,"column":1,"offset":2791},"indent":[1,1,1]}},{"type":"html","value":"<code class=\"language-text\">$ rails g rspec:model your_model_test_name</code>","position":{"start":{"line":96,"column":1,"offset":2791},"end":{"line":96,"column":45,"offset":2835},"indent":[]}},{"type":"text","value":"\n生成功能测试文件，针对controllers进行测试：\n","position":{"start":{"line":96,"column":45,"offset":2835},"end":{"line":98,"column":1,"offset":2864},"indent":[1,1]}},{"type":"html","value":"<code class=\"language-text\">$ rails g rspec:controller your_controller_test_name</code>","position":{"start":{"line":98,"column":1,"offset":2864},"end":{"line":98,"column":55,"offset":2918},"indent":[]}},{"type":"text","value":"\n生成集成测试文件，针对work flow进行测试：\n","position":{"start":{"line":98,"column":55,"offset":2918},"end":{"line":100,"column":1,"offset":2945},"indent":[1,1]}},{"type":"html","value":"<code class=\"language-text\">$ rails g integration_test your_integration_test_name</code>","position":{"start":{"line":100,"column":1,"offset":2945},"end":{"line":100,"column":56,"offset":3000},"indent":[]}},{"type":"text","value":"\n对应不同的测试文件type也是不同的，但是测试用例的书写是一样的，具体定义如下：","position":{"start":{"line":100,"column":56,"offset":3000},"end":{"line":101,"column":41,"offset":3041},"indent":[1]}}],"position":{"start":{"line":93,"column":1,"offset":2555},"end":{"line":101,"column":41,"offset":3041},"indent":[1,1,1,1,1,1,1,1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">describe <span class=\"token string\">\"Your tes description\"</span> <span class=\"token keyword\">do</span>\n    it <span class=\"token string\">\"Your test case\"</span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\">#some operate</span>\n      expect<span class=\"token punctuation\">(</span>actual_var<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to expect_var\n    <span class=\"token keyword\">end</span>\n    \n    it <span class=\"token string\">\"Your another test case\"</span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\">#some operate</span>\n      expect<span class=\"token punctuation\">(</span>actual_var<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to expect_var\n    <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":103,"column":1,"offset":3043},"end":{"line":115,"column":4,"offset":3294},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"最后在命令行中输入如下语句检测测试文件是否通过\n","position":{"start":{"line":116,"column":1,"offset":3295},"end":{"line":117,"column":1,"offset":3319},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">$ rspec spec/mdoels/your_model_test_case</code>","position":{"start":{"line":117,"column":1,"offset":3319},"end":{"line":117,"column":43,"offset":3361},"indent":[]}},{"type":"text","value":"\n也可以执行如下命令测试全部用例\n","position":{"start":{"line":117,"column":43,"offset":3361},"end":{"line":119,"column":1,"offset":3378},"indent":[1,1]}},{"type":"html","value":"<code class=\"language-text\">$ rspec spec</code>","position":{"start":{"line":119,"column":1,"offset":3378},"end":{"line":119,"column":15,"offset":3392},"indent":[]}}],"position":{"start":{"line":116,"column":1,"offset":3295},"end":{"line":119,"column":15,"offset":3392},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【4】with factory_girl for unit test","position":{"start":{"line":121,"column":1,"offset":3394},"end":{"line":121,"column":35,"offset":3428},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":3394},"end":{"line":121,"column":35,"offset":3428},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"从标题可以看出来，这部分要简单说明如何通过rspec和factory","position":{"start":{"line":123,"column":1,"offset":3430},"end":{"line":123,"column":35,"offset":3464},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"girl一起对models进行单元测试。对models测试最核心的准备工作就是测试数据的维护，这里采用factory","position":{"start":{"line":123,"column":36,"offset":3465},"end":{"line":123,"column":94,"offset":3523},"indent":[]}}],"position":{"start":{"line":123,"column":35,"offset":3464},"end":{"line":123,"column":95,"offset":3524},"indent":[]}},{"type":"text","value":"girl来管理，首先说明factory_girl中的数据是如何定义的。\n之前提到过在spec目录下创建了一个factories.rb，这个文件就是存放原始测试数据的。这里以user为例简单示例代码如下：","position":{"start":{"line":123,"column":95,"offset":3524},"end":{"line":124,"column":66,"offset":3625},"indent":[1]}}],"position":{"start":{"line":123,"column":1,"offset":3430},"end":{"line":124,"column":66,"offset":3625},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">FactoryGirl</span><span class=\"token punctuation\">.</span>define <span class=\"token keyword\">do</span>\n\tfactory <span class=\"token symbol\">:user</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>f<span class=\"token operator\">|</span>\n\t\tf<span class=\"token punctuation\">.</span>email <span class=\"token string\">\"admin@163.com\"</span>\n\t\tf<span class=\"token punctuation\">.</span>encrypted_password <span class=\"token string\">\"$2a$10$jJNRjL9XlQr4zhxwGCLUceiVtSX9X9GPeTTdoSjCTQ7eWnrePXwcK\"</span>\n\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":126,"column":1,"offset":3627},"end":{"line":133,"column":4,"offset":3803},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"其中:user就是一条记录的表示，而user代码段内就是对应的字段名称和值。当进行单元测试需要向数据库插入这个user记录时，在代码中通过如下语句实现：","position":{"start":{"line":134,"column":1,"offset":3804},"end":{"line":134,"column":77,"offset":3880},"indent":[]}}],"position":{"start":{"line":134,"column":1,"offset":3804},"end":{"line":134,"column":77,"offset":3880},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">user <span class=\"token operator\">=</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"your_test_password\"</span><span class=\"token punctuation\">)</span></code></pre></div>","position":{"start":{"line":136,"column":1,"offset":3882},"end":{"line":138,"column":4,"offset":3946},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"如果你没有在rspec配置文件中作factory_girl的配置，那么就需要直接调用FactoryGirl方法来插入数据了：","position":{"start":{"line":139,"column":1,"offset":3947},"end":{"line":139,"column":63,"offset":4009},"indent":[]}}],"position":{"start":{"line":139,"column":1,"offset":3947},"end":{"line":139,"column":63,"offset":4009},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">user <span class=\"token operator\">=</span> <span class=\"token constant\">FatoryGirl</span><span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"your_test_password\"</span><span class=\"token punctuation\">)</span></code></pre></div>","position":{"start":{"line":141,"column":1,"offset":4011},"end":{"line":143,"column":4,"offset":4086},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【5】with capybara for integration test","position":{"start":{"line":145,"column":1,"offset":4088},"end":{"line":145,"column":38,"offset":4125},"indent":[]}}],"position":{"start":{"line":145,"column":1,"offset":4088},"end":{"line":145,"column":38,"offset":4125},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"在写集成测试用例的时候通常会用capybara提供的语法来模拟用户操作，并预期结果进行对比。而在做单元测试（针对models）和功能测试（针对controllers）时用rspec-rails本身的语法就可以。这里简单通过一个登录例子来简单展示下capybara：","position":{"start":{"line":147,"column":1,"offset":4127},"end":{"line":147,"column":133,"offset":4259},"indent":[]}}],"position":{"start":{"line":147,"column":1,"offset":4127},"end":{"line":147,"column":133,"offset":4259},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token string\">\"LoginTests\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:request</span> <span class=\"token keyword\">do</span>\n  describe <span class=\"token string\">\"GET /login_tests\"</span> <span class=\"token keyword\">do</span>\n  \tbefore <span class=\"token keyword\">do</span>\n  \t\t<span class=\"token variable\">@user</span> <span class=\"token operator\">=</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"admin1234\"</span><span class=\"token punctuation\">)</span>\n  \t<span class=\"token keyword\">end</span>\n\n    it <span class=\"token string\">\"works! (now write some real specs)\"</span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\"># user = build(:user)</span>\n      visit new_user_session_path\n      expect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"后台管理\"</span><span class=\"token punctuation\">)</span>\n      fill_in <span class=\"token string\">'user_password'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"admin1234\"</span>\n      page<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">'.btn-primary'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>click\n      expect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"首页\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"登陆失败\"</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":149,"column":1,"offset":4261},"end":{"line":166,"column":4,"offset":4728},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【6】auth by devise in tegration test","position":{"start":{"line":168,"column":1,"offset":4730},"end":{"line":168,"column":36,"offset":4765},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":4730},"end":{"line":168,"column":36,"offset":4765},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"当你用到devise作为登陆模块的时候，想要在集成测试中设置登陆权限时需要在rails","position":{"start":{"line":170,"column":1,"offset":4767},"end":{"line":170,"column":44,"offset":4810},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"hepler.rb中添加Warden::Test::Helpers的引用，Warden是devise用来做登陆所依赖的gem，因为devise的方法无法在requests目录下很好的兼容，所以这里直接使用它底层依赖的gem进行登陆的设置。\n在rails","position":{"start":{"line":170,"column":45,"offset":4811},"end":{"line":171,"column":7,"offset":4937},"indent":[1]}}],"position":{"start":{"line":170,"column":44,"offset":4810},"end":{"line":171,"column":8,"offset":4938},"indent":[1]}},{"type":"text","value":"helper.rb顶部添加如下语句。","position":{"start":{"line":171,"column":8,"offset":4938},"end":{"line":171,"column":26,"offset":4956},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":4767},"end":{"line":171,"column":26,"offset":4956},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">include <span class=\"token constant\">Warden</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Test</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Helpers</span>     \n<span class=\"token constant\">Warden</span><span class=\"token punctuation\">.</span>test_mode<span class=\"token operator\">!</span></code></pre></div>","position":{"start":{"line":173,"column":1,"offset":4958},"end":{"line":176,"column":4,"offset":5022},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"当需要在集成测试中添加登陆设置时，按照如下语句：","position":{"start":{"line":177,"column":1,"offset":5023},"end":{"line":177,"column":25,"offset":5047},"indent":[]}}],"position":{"start":{"line":177,"column":1,"offset":5023},"end":{"line":177,"column":25,"offset":5047},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"> let<span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:admin</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">@user</span> <span class=\"token operator\">=</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"admin1234\"</span><span class=\"token punctuation\">)</span>\n      login_as <span class=\"token variable\">@user</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:run_callbacks</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token keyword\">false</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":179,"column":1,"offset":5049},"end":{"line":184,"column":4,"offset":5193},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【7】javascript support by capybara-webkit\n这里capybara-webkit是一个capybara的浏览器gem，它可以提供capybara对js语句的自动执行，也就是说当你的测试类中需要测试js的时候就需要用到这个gem，其他提供该功能的gem还有selenium，poltergeist，capybara-webkit运行效率相对要高一些，但是因为它是基于qt的，所以如果你想采用capybara-webkit作为js的支持，那么首先要安装qt。最后当你在it中要测试js的时候记得设置js: true。","position":{"start":{"line":185,"column":1,"offset":5194},"end":{"line":186,"column":234,"offset":5468},"indent":[1]}}],"position":{"start":{"line":185,"column":1,"offset":5194},"end":{"line":186,"column":234,"offset":5468},"indent":[1]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">  it <span class=\"token string\">\"a integration test for js\"</span><span class=\"token punctuation\">,</span> js<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span> <span class=\"token keyword\">do</span>\n  <span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":188,"column":1,"offset":5470},"end":{"line":191,"column":4,"offset":5533},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"更多用法请参考官方API","position":{"start":{"line":193,"column":1,"offset":5535},"end":{"line":193,"column":13,"offset":5547},"indent":[]}},{"type":"link","title":null,"url":"http://www.rubydoc.info/github/jnicklas/capybara","children":[{"type":"text","value":"http://www.rubydoc.info/github/jnicklas/capybara","position":{"start":{"line":193,"column":13,"offset":5547},"end":{"line":193,"column":61,"offset":5595},"indent":[]}}],"position":{"start":{"line":193,"column":13,"offset":5547},"end":{"line":193,"column":61,"offset":5595},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":5535},"end":{"line":193,"column":61,"offset":5595},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"【附录1】rails_helper.rb","position":{"start":{"line":195,"column":1,"offset":5597},"end":{"line":195,"column":21,"offset":5617},"indent":[]}}],"position":{"start":{"line":195,"column":1,"offset":5597},"end":{"line":195,"column":21,"offset":5617},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># This file is copied to spec/ when you run 'rails generate rspec:install'</span>\n<span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'RAILS_ENV'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span><span class=\"token operator\">=</span> <span class=\"token string\">'test'</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'spec_helper'</span>\n<span class=\"token keyword\">require</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>expand_path<span class=\"token punctuation\">(</span><span class=\"token string\">'../../config/environment'</span><span class=\"token punctuation\">,</span> __FILE__<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'rspec/rails'</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'capybara/rspec'</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'database_cleaner'</span>\n\n<span class=\"token comment\">#auth for integration test.</span>\ninclude <span class=\"token constant\">Warden</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Test</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Helpers</span>     \n<span class=\"token constant\">Warden</span><span class=\"token punctuation\">.</span>test_mode<span class=\"token operator\">!</span>\n\n<span class=\"token comment\"># If you are not using ActiveRecord, you can remove this line.</span>\n<span class=\"token comment\">#ActiveRecord::Migration.maintain_test_schema!</span>\n\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n  <span class=\"token comment\">#use Capybara in test files.</span>\n  config<span class=\"token punctuation\">.</span>include <span class=\"token constant\">Capybara</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">DSL</span>\n  <span class=\"token comment\">#support for javascript when integration test run.</span>\n  <span class=\"token constant\">Capybara</span><span class=\"token punctuation\">.</span>javascript_driver <span class=\"token operator\">=</span> <span class=\"token symbol\">:webkit</span>\n  <span class=\"token comment\">#use FactoryGirl in test files.</span>\n  config<span class=\"token punctuation\">.</span>include <span class=\"token constant\">FactoryGirl</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Syntax</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Methods</span>\n\n  <span class=\"token comment\">#use database_cleaner instead auto datas clear, for fix bugs in integration test.</span>\n  config<span class=\"token punctuation\">.</span>use_transactional_fixtures <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span>\n  config<span class=\"token punctuation\">.</span>before<span class=\"token punctuation\">(</span><span class=\"token symbol\">:suite</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n    <span class=\"token constant\">DatabaseCleaner</span><span class=\"token punctuation\">.</span>clean_with <span class=\"token symbol\">:truncation</span>\n    <span class=\"token constant\">DatabaseCleaner</span><span class=\"token punctuation\">.</span>strategy <span class=\"token operator\">=</span> <span class=\"token symbol\">:transaction</span>\n  <span class=\"token keyword\">end</span>\n  <span class=\"token comment\">#include support conig file if you have</span>\n  <span class=\"token comment\">#config.infer_spec_type_from_file_location!</span>\n  <span class=\"token comment\">#config.expect_with(:rspec) { https://robots.thoughtbot.com/how-we-test-rails-applications|c| c.syntax = :should }</span>\n \n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":197,"column":1,"offset":5619},"end":{"line":232,"column":4,"offset":6808},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【附录2】单元测试用例","position":{"start":{"line":233,"column":1,"offset":6809},"end":{"line":233,"column":12,"offset":6820},"indent":[]}}],"position":{"start":{"line":233,"column":1,"offset":6809},"end":{"line":233,"column":12,"offset":6820},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'rails_helper'</span>\n\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token constant\">Admin</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Article</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:model</span> <span class=\"token keyword\">do</span>\n\n\tcontext <span class=\"token string\">\"will vaild\"</span> <span class=\"token keyword\">do</span>\n\t\tit <span class=\"token string\">\"when all field filled\"</span> <span class=\"token keyword\">do</span>\n\t\t\tarticle <span class=\"token operator\">=</span> build<span class=\"token punctuation\">(</span><span class=\"token symbol\">:article</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be_valid\n\t\t<span class=\"token keyword\">end</span>\n\t<span class=\"token keyword\">end</span>\n\n\tcontext <span class=\"token string\">\"will not vaild\"</span> <span class=\"token keyword\">do</span>\n\t\tit <span class=\"token string\">\"when artile category id is empty\"</span> <span class=\"token keyword\">do</span>\n\t\t\tarticle <span class=\"token operator\">=</span> build<span class=\"token punctuation\">(</span><span class=\"token symbol\">:article</span><span class=\"token punctuation\">,</span> article_category_id<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not_to be_valid\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">[</span><span class=\"token symbol\">:article_category_id</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to include <span class=\"token string\">\"不能为空\"</span>\n\t\t<span class=\"token keyword\">end</span>\n\n\t\tit <span class=\"token string\">\"when title is empty\"</span> <span class=\"token keyword\">do</span>\n\t\t\tarticle <span class=\"token operator\">=</span> build<span class=\"token punctuation\">(</span><span class=\"token symbol\">:article</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not_to be_valid\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">[</span><span class=\"token symbol\">:title</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to include <span class=\"token string\">\"不能为空\"</span>\n\t\t<span class=\"token keyword\">end</span>\n\n\t\tit <span class=\"token string\">\"when content is empty\"</span> <span class=\"token keyword\">do</span>\n\t\t\tarticle <span class=\"token operator\">=</span> build<span class=\"token punctuation\">(</span><span class=\"token symbol\">:article</span><span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not_to be_valid\n\t\t\texpect<span class=\"token punctuation\">(</span>article<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">[</span><span class=\"token symbol\">:content</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to include <span class=\"token string\">\"不能为空\"</span>\n\t\t<span class=\"token keyword\">end</span>\n\t<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":235,"column":1,"offset":6822},"end":{"line":269,"column":4,"offset":7642},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【附录3】集成测试用例","position":{"start":{"line":271,"column":1,"offset":7644},"end":{"line":271,"column":12,"offset":7655},"indent":[]}}],"position":{"start":{"line":271,"column":1,"offset":7644},"end":{"line":271,"column":12,"offset":7655},"indent":[]}},{"type":"html","lang":"ruby","value":"<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'rails_helper'</span>\n\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token string\">\"PageTests\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:request</span> <span class=\"token keyword\">do</span>\n\tdescribe <span class=\"token string\">\"GET /page_tests\"</span> <span class=\"token keyword\">do</span>\n\t\tlet<span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:admin</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">@user</span> <span class=\"token operator\">=</span> create<span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"admin1234\"</span><span class=\"token punctuation\">)</span>\n\t\t\tlogin_as <span class=\"token variable\">@user</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:run_callbacks</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token keyword\">false</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\tit <span class=\"token string\">\"safely workflow\"</span> <span class=\"token keyword\">do</span>\n\t\t\tvisit admin_pages_path\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"文档管理\"</span><span class=\"token punctuation\">)</span>\n\t\t\tclick_link <span class=\"token string\">'添加'</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"编辑文档\"</span><span class=\"token punctuation\">)</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_title'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"测试文档标题\"</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_abstract'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"测试文档摘要\"</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_content'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"测试文档内容\"</span>\n\t\t\tclick_button <span class=\"token string\">'提交'</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"文档添加成功。\"</span><span class=\"token punctuation\">)</span>\n\t\t\tclick_link <span class=\"token string\">'修改'</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_selector<span class=\"token punctuation\">(</span><span class=\"token string\">\"input[value='测试文档标题']\"</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_field<span class=\"token punctuation\">(</span><span class=\"token string\">'admin_page_abstract'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">'测试文档摘要'</span><span class=\"token punctuation\">)</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_field<span class=\"token punctuation\">(</span><span class=\"token string\">'admin_page_content'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">'测试文档内容'</span><span class=\"token punctuation\">)</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_title'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"修改测试文档标题\"</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_abstract'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"修改测试文档摘要\"</span>\n\t\t\tfill_in <span class=\"token string\">'admin_page_content'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">\"修改测试文档内容\"</span>\n\t\t\tclick_button <span class=\"token string\">'提交'</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"文档更新成功。\"</span><span class=\"token punctuation\">)</span>\n\t\t\tclick_link <span class=\"token string\">'返回'</span>\n\t\t\tclick_link <span class=\"token string\">'删除'</span>\n\t\t\texpect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">\"文档删除成功。\"</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">end</span>\n\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>","position":{"start":{"line":273,"column":1,"offset":7657},"end":{"line":308,"column":4,"offset":8777},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"【附录4】参考播客","position":{"start":{"line":310,"column":1,"offset":8779},"end":{"line":310,"column":10,"offset":8788},"indent":[]}}],"position":{"start":{"line":310,"column":1,"offset":8779},"end":{"line":310,"column":10,"offset":8788},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"1】.","position":{"start":{"line":312,"column":1,"offset":8790},"end":{"line":312,"column":4,"offset":8793},"indent":[]}},{"type":"linkReference","identifier":"setting up the bdd stack on a new rails 4 application","referenceType":"shortcut","children":[{"type":"text","value":"Setting up the BDD stack on a new Rails 4 application","position":{"start":{"line":312,"column":5,"offset":8794},"end":{"line":312,"column":58,"offset":8847},"indent":[]}}],"position":{"start":{"line":312,"column":4,"offset":8793},"end":{"line":312,"column":59,"offset":8848},"indent":[]}}],"position":{"start":{"line":312,"column":1,"offset":8790},"end":{"line":312,"column":59,"offset":8848},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"2】.","position":{"start":{"line":314,"column":1,"offset":8850},"end":{"line":314,"column":4,"offset":8853},"indent":[]}},{"type":"linkReference","identifier":"how we test rails applications","referenceType":"shortcut","children":[{"type":"text","value":"How We Test Rails Applications","position":{"start":{"line":314,"column":5,"offset":8854},"end":{"line":314,"column":35,"offset":8884},"indent":[]}}],"position":{"start":{"line":314,"column":4,"offset":8853},"end":{"line":314,"column":36,"offset":8885},"indent":[]}}],"position":{"start":{"line":314,"column":1,"offset":8850},"end":{"line":314,"column":36,"offset":8885},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"3】.","position":{"start":{"line":316,"column":1,"offset":8887},"end":{"line":316,"column":4,"offset":8890},"indent":[]}},{"type":"linkReference","identifier":"installing rspec and capybara in rails 4.1","referenceType":"shortcut","children":[{"type":"text","value":"Installing RSpec and Capybara in Rails 4.1","position":{"start":{"line":316,"column":5,"offset":8891},"end":{"line":316,"column":47,"offset":8933},"indent":[]}}],"position":{"start":{"line":316,"column":4,"offset":8890},"end":{"line":316,"column":48,"offset":8934},"indent":[]}}],"position":{"start":{"line":316,"column":1,"offset":8887},"end":{"line":316,"column":48,"offset":8934},"indent":[]}},{"type":"definition","identifier":"setting up the bdd stack on a new rails 4 application","title":null,"url":"https://semaphoreapp.com/blog/2013/08/14/setting-up-bdd-stack-on-a-new-rails-4-application.html","position":{"start":{"line":318,"column":1,"offset":8936},"end":{"line":318,"column":158,"offset":9093},"indent":[]}},{"type":"definition","identifier":"how we test rails applications","title":null,"url":"https://robots.thoughtbot.com/how-we-test-rails-applications","position":{"start":{"line":319,"column":1,"offset":9094},"end":{"line":319,"column":97,"offset":9190},"indent":[]}},{"type":"definition","identifier":"installing rspec and capybara in rails 4.1","title":null,"url":"https://github.com/jekyll/jekyll-help","position":{"start":{"line":320,"column":1,"offset":9191},"end":{"line":320,"column":84,"offset":9274},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":320,"column":84,"offset":9274}}}}